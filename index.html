<!doctype html>
<!--
	Copyright 2018 The Go Authors. All rights reserved.
	Use of this source code is governed by a BSD-style
	license that can be found in the LICENSE file.
-->
<html>

	<head>
		<meta charset="utf-8">
		<title>London Mulligan simulator</title>

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto:300,300italic,700,700italic">


<link rel="stylesheet" href="//cdn.rawgit.com/necolas/normalize.css/master/normalize.css">


<link rel="stylesheet" href="//cdn.rawgit.com/milligram/milligram/master/dist/milligram.min.css">
<link rel="stylesheet" href="main.css">

	</head>

	<body>
		<!--
	  Add the following polyfill for Microsoft Edge 17/18 support:
	  <script src="https://cdn.jsdelivr.net/npm/text-encoding@0.7.0/lib/encoding.min.js"></script>
	  (see https://caniuse.com/#feat=textencoder)
	  -->
	  <script src="wasm_exec.js"></script>
	  <script>
		  if (!WebAssembly.instantiateStreaming) { // polyfill
			  WebAssembly.instantiateStreaming = async (resp, importObject) => {
				  const source = await (await resp).arrayBuffer();
				  return await WebAssembly.instantiate(source, importObject);
			  };
		  }
const go = new Go();
let mod, inst;
WebAssembly.instantiateStreaming(fetch("lib.wasm"), go.importObject).then(
	async result => {
		mod = result.module;
		inst = result.instance;
		await go.run(inst);
	}
);


function process() {
	var max = document.getElementById('trys').value;
	var p = document.getElementById('pool').value;
	var e = document.getElementById('eval').value;
	var mHand = document.getElementById('minHand').value;
	var bar = document.getElementById('progBar');

	bar.max = max;
	var s = 0;
	var tick = max/100;

	/*	for (i=0;i<max;i++) {
		var re = stuff(p, e);
		if (re==true) {
			s++;
		}
	}*/
	var i = 0;
	(function doSort() {
		if (i%tick==0) {
			bar.value=i;
		}
		var re = stuff(p,e,mHand);
		if (re==true) {
			s++;
		}
		i++;
		if (i<max) {
			setTimeout(doSort,0);
		} else {
			bar.value=max;
			outProgress(s, max);
		}
	})();

}

function outProgress(s, max) {
	var percent = s/max*100;
	document.getElementById("output").innerHTML = `${s} of ${max} [${percent}%]`;
}

	  </script>

		<header class="container">
			<h1>London Mulligan Simulator</h1>
		</header>
		<section class="container">
			<form>
				<fieldset>
					<div class="input-group fluid">
					<label for="pool">Card Pool</label>
					<input type="text" id="pool" />
					</div>
					<div class="input-group fluid">
					<label for="eval">Logic</label>
					<input type="text" id="eval" />
					</div>
					<div class="input-group fluid">
					<label for="trys">Number of simulations</label>
					<input type="number" id="trys" min="1" value="1000">
					</div>
					<div class="input-group fluid">
					<label type="minHand">Mininum hand size</label>
					<input type="number" id="minHand" min="1" max="7" value="5">
					<div>
				</fieldset>
			</form>
			<button result=false onClick="process();" class="primary" id="runButton" >Run</button>
			<section class="out-group">
				<h1>Results:</h>
					<progress id="progBar" value="0" max="100"></progress>
					<h4 id="output"></h1>
			</section>
		</section>
		<section class="container">
			<article>
				<h3>What is it?</h3>
				<p>This is an experimental london mulligan monti carlo simulator for Magic the Gathering. It
				is in no way complete or bug free. This started off as an experiment in working with go wasm.</p>
				<h3>How to Use</h3>
				<h4>Card Pool</h4>
				<p>Enter a string here in the form of 4a where 4 is the number of card a. If only one of a card
				you may omit the number. Only use 1 letter symbols for cards</p>
				<p>Examples:</p>
				<ul>
					<li>4a4bc</li>
					<li>4a4b4c4d</li>
					<li>a</li>
					<li>20a</li>
				</ul>
				<h4>Logic</h4>
				<p>Enter a string of boolean logic. The allowed opperators are [&, |, ^, !]. Parantheses are allowed.
				Use the same symbols as in the Card Pool.</p>
				<p>Examples:</p>
				<ul>
					<li>a&b</li>
					<li>a|b</li>
					<li>(a&b&(c^d))|((a^b)&c&d)</li>
					<li>!(a&b)</li>
				</ul>
			</article>
		</section>
		<footer class="container">
			<p>By Paul Schuster</p>
			<p>Writen in Go WASM</p>
			<p>v 0.2.1 </p>
		</footer>
	</body>

</html>
