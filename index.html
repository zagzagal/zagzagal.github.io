<!doctype html>
<!--
	Copyright 2018 The Go Authors. All rights reserved.
	Use of this source code is governed by a BSD-style
	license that can be found in the LICENSE file.
-->
<html>

	<head>
		<meta charset="utf-8">
		<title>Go wasm</title>
	</head>

	<body>
		<!--
	  Add the following polyfill for Microsoft Edge 17/18 support:
	  <script src="https://cdn.jsdelivr.net/npm/text-encoding@0.7.0/lib/encoding.min.js"></script>
	  (see https://caniuse.com/#feat=textencoder)
	  -->
	  <script src="wasm_exec.js"></script>
	  <script>
		  if (!WebAssembly.instantiateStreaming) { // polyfill
			  WebAssembly.instantiateStreaming = async (resp, importObject) => {
				  const source = await (await resp).arrayBuffer();
				  return await WebAssembly.instantiate(source, importObject);
			  };
		  }
const go = new Go();
let mod, inst;
WebAssembly.instantiateStreaming(fetch("lib.wasm"), go.importObject).then(
	async result => {
		mod = result.module;
		inst = result.instance;
		await go.run(inst);
	}
);


function process() {
	var max = document.getElementById('trys').value;
	var p = document.getElementById('pool').value;
	var e = document.getElementById('eval').value;
	var bar = document.getElementById('progBar');

	bar.max = max;
	var s = 0;
	var tick = max/100;

/*	for (i=0;i<max;i++) {
		var re = stuff(p, e);
		if (re==true) {
			s++;
		}
	}*/
	var i = 0;
	(function doSort() {
		if (i%tick==0) {
			bar.value=i;
		}
		var re = stuff(p,e);
		if (re==true) {
			s++;
		}
    		i++;
		if (i<max) {
			setTimeout(doSort,0);
		} else {
			bar.value=max;
			outProgress(s, max);
		}
	})();

}

function outProgress(s, max) {
	var percent = s/max*100;
	document.getElementById("output").innerHTML = `${s} of ${max} [${percent}%]`;
}

	  </script>

	  <main>
		  <form>
			  <fieldset>
			  <label for="pool">Card Pool</label>
			  <input type="text" id="pool" />
			  <label for="eval">Logic</label>
			  <input type="text" id="eval" />
			  <label for="trys">Number of simulations</label>
			  <input type="number" id="trys" min="1" value="1000">
		  </fieldset>
		  </form>
		  <button result=false onClick="process();" id="runButton" >Run</button>
		  <section class="out-group">
			  <h1>Results:</h>
			  <progress id="progBar" value="0" max="100"></progress>
			  <h4 id="output"></h1>
		  </section>
	  </main>
	</body>

</html>
